<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Brands Mission Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #0a0e1a;
            color: #e0e0e0;
            min-height: 100vh;
            position: relative;
        }
        
        /* Circuit Board Background */
        #circuitCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none !important;
        }
        
        #passwordScreen, #dashboard, .modal {
            position: relative;
            z-index: 2;
        }
        
        /* Animated pulse glow on header */
        @keyframes headerPulse {
            0%, 100% { text-shadow: 0 0 20px rgba(0, 217, 255, 0.3), 0 0 40px rgba(0, 217, 255, 0.1); }
            50% { text-shadow: 0 0 30px rgba(0, 217, 255, 0.6), 0 0 60px rgba(0, 217, 255, 0.2), 0 0 80px rgba(168, 85, 247, 0.1); }
        }
        
        @keyframes borderGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(0, 217, 255, 0.1); }
            50% { box-shadow: 0 0 25px rgba(0, 217, 255, 0.2), 0 0 50px rgba(168, 85, 247, 0.05); }
        }
        
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        
        /* Password Screen */
        #passwordScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: transparent;
        }
        
        .password-box {
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid #2d5a8a;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .password-box h1 {
            font-size: 38px;
            margin-bottom: 10px;
            color: #00d9ff;
        }
        
        .password-box p {
            color: #888;
            margin-bottom: 30px;
        }
        
        .password-box input {
            width: 100%;
            padding: 12px;
            font-size: 26px;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            background: #0a0e1a;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .password-box button {
            width: 100%;
            padding: 12px;
            font-size: 26px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            background: #00d9ff;
            color: #0a0e1a;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .password-box button:hover {
            background: #33e5ff;
        }
        
        .password-error {
            color: #ff4444;
            font-size: 22px;
            margin-top: 10px;
            display: none;
        }
        
        /* Dashboard */
        #dashboard {
            display: none;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }
        
        .header h1 {
            font-size: 56px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -1px;
            color: #00d9ff;
            animation: headerPulse 4s ease-in-out infinite;
        }
        
        .header .subtitle {
            color: #8899aa;
            font-size: 26px;
            letter-spacing: 4px;
            text-transform: uppercase;
        }
        
        /* Grid Layout - ARK Style */
        .ventures-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        @media (max-width: 1200px) {
            .ventures-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .ventures-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Venture Box */
        .venture-box {
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid #2d5a8a;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            animation: borderGlow 6s ease-in-out infinite;
        }
        
        .venture-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--brand-color);
            opacity: 0.9;
            box-shadow: 0 0 12px var(--brand-color);
        }
        
        .venture-box::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0.08;
            background-image:
                linear-gradient(90deg, var(--brand-color) 1px, transparent 1px),
                linear-gradient(0deg, var(--brand-color) 1px, transparent 1px),
                radial-gradient(circle 3px, var(--brand-color) 2px, transparent 2px);
            background-size: 25px 25px, 25px 25px, 25px 25px;
            background-position: 0 0, 0 0, 12.5px 12.5px;
            mask-image: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 50%, transparent 80%);
            -webkit-mask-image: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 50%, transparent 80%);
        }
        
        .venture-box:hover {
            border-color: var(--brand-color);
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.2), 0 0 40px rgba(168, 85, 247, 0.15), 0 8px 30px rgba(0, 0, 0, 0.4), inset 0 0 30px rgba(0, 217, 255, 0.03);
        }
        
        .venture-box:hover::after {
            opacity: 0.15;
        }
        
        .venture-name {
            font-size: 38px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--brand-color);
        }
        
        .venture-tagline {
            font-size: 24px;
            color: #6b7d93;
            margin-bottom: 15px;
        }
        
        .venture-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat {
            text-align: left;
        }
        
        .stat-label {
            font-size: 22px;
            color: #5a6b7d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 34px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        /* Center Command Box */
        .command-center {
            background: linear-gradient(135deg, rgba(13, 26, 42, 0.9) 0%, rgba(17, 24, 39, 0.9) 50%, rgba(13, 21, 37, 0.9) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid #00d9ff;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            animation: borderGlow 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .command-center::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00d9ff, #a855f7, #00d9ff, #a855f7);
            background-size: 400% 400%;
            border-radius: 13px;
            z-index: -1;
            opacity: 0.15;
            animation: gradientShift 8s ease infinite;
            pointer-events: none;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .command-center h2 {
            font-size: 44px;
            margin-bottom: 20px;
            color: #00d9ff;
            text-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
        }
        
        .command-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .command-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .command-stat {
            padding: 15px;
            background: rgba(0, 217, 255, 0.05);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 10px;
        }
        
        .command-stat-value {
            font-size: 48px;
            font-weight: 700;
            color: #00d9ff;
            margin-bottom: 6px;
        }
        
        .command-stat-label {
            font-size: 24px;
            color: #8899aa;
        }
        
        .command-stat.clickable {
            cursor: pointer;
        }
        
        .command-stat.clickable:hover {
            background: rgba(0, 217, 255, 0.12);
            border-color: rgba(0, 217, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.15);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(17, 24, 39, 0.92);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            max-width: 900px;
            margin: 40px auto;
            border-radius: 12px;
            padding: 40px;
            position: relative;
            border: 1px solid #2d5a8a;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 44px;
            font-weight: 300;
            color: #5a6b7d;
            cursor: pointer;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #00d9ff;
        }
        
        .modal h2 {
            font-size: 48px;
            margin-bottom: 10px;
            color: #00d9ff;
        }
        
        .modal .subtitle {
            color: #8899aa;
            font-size: 26px;
            margin-bottom: 30px;
        }
        
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .agent-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .agent-card {
            background: #0d1525;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .agent-name {
            font-size: 34px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #00d9ff;
        }
        
        .agent-role {
            font-size: 26px;
            color: #8899aa;
            margin-bottom: 10px;
        }
        
        .agent-duty {
            font-size: 24px;
            color: #99aabb;
            line-height: 1.5;
        }
        
        .agent-card:hover {
            border-color: #00d9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 217, 255, 0.15);
        }
        
        /* Agent Detail Modal */
        .detail-section {
            margin-bottom: 30px;
        }
        
        .detail-section h3 {
            font-size: 32px;
            font-weight: 700;
            color: #00d9ff;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #2d5a8a;
        }
        
        .detail-task {
            background: #0d1525;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            padding: 16px 18px;
            margin-bottom: 10px;
        }
        
        .detail-task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .detail-task-from {
            font-size: 24px;
            color: #8899aa;
        }
        
        .detail-task-body {
            font-size: 26px;
            color: #c0d0e0;
            line-height: 1.5;
        }
        
        .collab-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .collab-chip {
            padding: 10px 18px;
            background: #1a2740;
            border: 1px solid #2d5a8a;
            border-radius: 20px;
            font-size: 26px;
            font-weight: 600;
            color: #c0d0e0;
        }
        
        .collab-chip.external {
            background: #2a1f00;
            border-color: #6b5000;
            color: #ffc107;
        }
        
        .asset-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .asset-item {
            padding: 12px 16px;
            background: #0d1a2a;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            font-size: 26px;
            color: #88bbdd;
        }
        
        .progress-bar-container {
            background: #1a2740;
            border-radius: 8px;
            height: 10px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 8px;
            transition: width 0.3s;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 22px;
            color: #8899aa;
            margin-top: 4px;
        }
        
        .empty-state {
            text-align: center;
            color: #888;
            padding: 20px;
            font-size: 22px;
        }
        
        /* Venture Detail */
        .venture-member {
            background: #0d1525;
            border: 1px solid #2d5a8a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .venture-member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .venture-member-name {
            font-size: 32px;
            font-weight: 700;
            color: #e0e0e0;
        }
        
        .venture-member-role {
            font-size: 22px;
            color: #5a6b7d;
            font-weight: 600;
        }
        
        .venture-member-tasks {
            margin-top: 10px;
        }
        
        .venture-task {
            padding: 10px 14px;
            background: #111827;
            border: 1px solid #1a2740;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 24px;
            color: #99aabb;
            line-height: 1.5;
        }
        
        .venture-task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            font-size: 22px;
            color: #5a6b7d;
        }
        
        /* Chat System */
        .chat-container {
            display: flex;
            height: 75vh;
            gap: 0;
        }
        
        .chat-sidebar {
            width: 240px;
            background: #0d1525;
            border-right: 1px solid #2d5a8a;
            border-radius: 10px 0 0 10px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .chat-sidebar-title {
            padding: 16px;
            font-size: 22px;
            font-weight: 700;
            color: #5a6b7d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #2d5a8a;
        }
        
        .chat-room {
            padding: 14px 16px;
            cursor: pointer;
            border-bottom: 1px solid #162030;
            transition: background 0.2s;
        }
        
        .chat-room:hover {
            background: #1a2740;
        }
        
        .chat-room.active {
            background: #00d9ff;
            color: #0a0e1a;
        }
        
        .chat-room-name {
            font-size: 24px;
            font-weight: 600;
        }
        
        .chat-room-desc {
            font-size: 20px;
            color: #5a6b7d;
            margin-top: 2px;
        }
        
        .chat-room.active .chat-room-desc {
            color: rgba(255,255,255,0.7);
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #111827;
            border-radius: 0 10px 10px 0;
        }
        
        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid #2d5a8a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header-name {
            font-size: 32px;
            font-weight: 700;
        }
        
        .chat-header-status {
            font-size: 22px;
            color: #5a6b7d;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .chat-msg {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 24px;
            line-height: 1.5;
        }
        
        .chat-msg.user {
            align-self: flex-end;
            background: #00d9ff;
            color: #0a0e1a;
            border-bottom-right-radius: 4px;
        }
        
        .chat-msg.agent {
            align-self: flex-start;
            background: #1a2740;
            color: #c0d0e0;
            border-bottom-left-radius: 4px;
        }
        
        .chat-msg-sender {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #00d9ff;
        }
        
        .chat-msg.user .chat-msg-sender {
            color: rgba(10,14,26,0.7);
        }
        
        .chat-msg-text {
            white-space: pre-wrap;
        }
        
        .chat-input-area {
            padding: 16px 20px;
            border-top: 1px solid #2d5a8a;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            font-size: 24px;
            border: 1px solid #2d5a8a;
            background: #0a0e1a;
            color: #e0e0e0;
            border-radius: 10px;
            outline: none;
            font-family: inherit;
        }
        
        .chat-input:focus {
            border-color: #00d9ff;
        }
        
        .chat-send {
            padding: 12px 24px;
            background: #00d9ff;
            color: #0a0e1a;
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .chat-send:hover {
            background: #33e5ff;
        }
        
        .chat-send:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .chat-typing {
            align-self: flex-start;
            padding: 10px 16px;
            background: #1a2740;
            border-radius: 12px;
            font-size: 22px;
            color: #888;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .chat-sidebar {
                width: 180px;
            }
        }
        
        /* Task Management */
        .task-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .task-controls select, .task-controls button {
            padding: 10px 16px;
            font-size: 22px;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            background: #0d1525;
            color: #c0d0e0;
            cursor: pointer;
        }
        
        .task-controls button {
            background: #00d9ff;
            color: #0a0e1a;
            border: none;
            font-weight: 600;
        }
        
        .task-controls button:hover {
            background: #33e5ff;
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .task-item {
            background: #0d1525;
            border: 1px solid #2d5a8a;
            border-radius: 10px;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .task-item.priority-high {
            border-left: 4px solid #e53e3e;
        }
        
        .task-item.priority-medium {
            border-left: 4px solid #dd6b20;
        }
        
        .task-item.priority-urgent {
            border-left: 4px solid #ff0000;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-agents {
            font-size: 24px;
            color: #8899aa;
        }
        
        .task-agents strong {
            color: #333;
        }
        
        .task-body {
            font-size: 26px;
            color: #c0d0e0;
            line-height: 1.5;
        }
        
        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }
        
        .task-meta {
            font-size: 20px;
            color: #888;
        }
        
        .task-actions {
            display: flex;
            gap: 8px;
        }
        
        .task-actions button {
            padding: 6px 14px;
            font-size: 20px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-start {
            background: #3182ce;
            color: #fff;
        }
        
        .btn-start:hover {
            background: #2b6cb0;
        }
        
        .btn-done {
            background: #38a169;
            color: #fff;
        }
        
        .btn-done:hover {
            background: #2f855a;
        }
        
        .btn-delete {
            background: #e53e3e;
            color: #fff;
        }
        
        .btn-delete:hover {
            background: #c53030;
        }
        
        .status-badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: #fefcbf;
            color: #975a16;
        }
        
        .status-in_progress {
            background: #bee3f8;
            color: #2a4365;
        }
        
        .status-done {
            background: #c6f6d5;
            color: #22543d;
        }
        
        /* New Task Form */
        .new-task-form {
            display: none;
            background: #0d1525;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .new-task-form.active {
            display: block;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .form-row select, .form-row input {
            flex: 1;
            padding: 10px;
            font-size: 22px;
            border: 1px solid #2d5a8a;
            border-radius: 8px;
            background: #0a0e1a;
            color: #c0d0e0;
        }
        
        .form-row textarea {
            width: 100%;
            padding: 10px;
            font-size: 22px;
            border: 1px solid #2d5a8a;
            background: #0a0e1a;
            color: #c0d0e0;
            border-radius: 8px;
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .form-actions button {
            padding: 10px 20px;
            font-size: 22px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .btn-submit {
            background: #00d9ff;
            color: #0a0e1a;
        }
        
        .btn-cancel {
            background: #2d5a8a;
            color: #c0d0e0;
        }
        
        /* Council Feed */
        .feed-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #2d5a8a;
        }
        
        .feed-tab {
            padding: 10px 20px;
            font-size: 22px;
            font-weight: 600;
            color: #5a6b7d;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        
        .feed-tab.active {
            color: #00d9ff;
            border-bottom-color: #00d9ff;
        }
        
        .feed-tab:hover {
            color: #c0d0e0;
        }
        
        .feed-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .feed-item {
            background: #0d1525;
            border: 1px solid #2d5a8a;
            border-radius: 10px;
            padding: 16px 20px;
        }
        
        .feed-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .feed-agent {
            font-weight: 700;
            font-size: 28px;
            color: #e0e0e0;
        }
        
        .feed-time {
            font-size: 20px;
            color: #888;
        }
        
        .feed-body {
            font-size: 26px;
            color: #99aabb;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .feed-direction {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 18px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .feed-direction.incoming {
            background: #bee3f8;
            color: #2a4365;
        }
        
        .feed-direction.outgoing {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .council-agent-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .agent-chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: 600;
            background: #1a2740;
            color: #8899aa;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .agent-chip.active {
            background: #00d9ff;
            color: #0a0e1a;
        }
        
        .agent-chip:hover {
            background: #2d5a8a;
        }
        
        .agent-chip.active:hover {
            background: #33e5ff;
        }
    </style>
</head>
<body>
    <canvas id="circuitCanvas"></canvas>
    <!-- Password Screen -->
    <div id="passwordScreen">
        <div class="password-box">
            <h1>Smart Brands Mission Control</h1>
            <p>Enter password to access dashboard</p>
            <input type="password" id="passwordInput" placeholder="Password" />
            <button onclick="checkPassword()">Access Dashboard</button>
            <div class="password-error" id="passwordError">Incorrect password</div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard">
        <div class="header">
            <h1>SMART BRANDS MISSION CONTROL</h1>
            <div class="subtitle">Six Ventures. One Vision. Billion Dollar Future.</div>
        </div>

        <div class="ventures-grid">
            <!-- SnapToSell -->
            <div class="venture-box" style="--brand-color: #FF6B35" onclick="openVenture('snaptosell')">
                <div class="venture-name">SnapToSell</div>
                <div class="venture-tagline">AI-Powered Marketplace Security</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Tasks</div>
                        <div class="stat-value" id="snaptosell-tasks">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" style="font-size: 22px;">Pre-Launch</div>
                    </div>
                </div>
            </div>

            <!-- Scripture Unlocked -->
            <div class="venture-box" style="--brand-color: #D4AE39" onclick="openVenture('scripture')">
                <div class="venture-name">Scripture Unlocked</div>
                <div class="venture-tagline">Ancient Wisdom, Modern AI</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Subscribers</div>
                        <div class="stat-value">2.4K</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Views</div>
                        <div class="stat-value">58K</div>
                    </div>
                </div>
            </div>

            <!-- BE DO HAVE -->
            <div class="venture-box" style="--brand-color: #C9A54C" onclick="openVenture('coaching')">
                <div class="venture-name">BE ‚úù DO ‚úù HAVE</div>
                <div class="venture-tagline">Creator Mindset Coaching</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Tasks</div>
                        <div class="stat-value" id="coaching-tasks">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" style="font-size: 22px;">Active</div>
                    </div>
                </div>
            </div>

            <!-- The Enemy Within -->
            <div class="venture-box" style="--brand-color: #8B0000" onclick="openVenture('book')">
                <div class="venture-name">The Enemy Within</div>
                <div class="venture-tagline">20 Years of Research. July 4, 2026</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Tasks</div>
                        <div class="stat-value" id="book-tasks">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Launch</div>
                        <div class="stat-value" style="font-size: 22px;">139 Days</div>
                    </div>
                </div>
            </div>

            <!-- Farm Flow -->
            <div class="venture-box" style="--brand-color: #228B22" onclick="openVenture('farm')">
                <div class="venture-name">Farm Flow</div>
                <div class="venture-tagline">Voice-Guided Animal Care</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Tasks</div>
                        <div class="stat-value" id="farm-tasks">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" style="font-size: 22px;">Development</div>
                    </div>
                </div>
            </div>

            <!-- Aeromind Ops -->
            <div class="venture-box" style="--brand-color: #0EA5E9" onclick="openVenture('aeromind')">
                <div class="venture-name">Aeromind Ops</div>
                <div class="venture-tagline">AI Strategy Consulting</div>
                <div class="venture-stats">
                    <div class="stat">
                        <div class="stat-label">Tasks</div>
                        <div class="stat-value" id="aeromind-tasks">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" style="font-size: 22px;">Active</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Command Center -->
        <div class="command-center">
            <h2>‚ö° COMMAND CENTER</h2>
            <div class="command-stats">
                <div class="command-stat clickable" onclick="showCouncilTasks()">
                    <div class="command-stat-value" id="council-task-count">‚Äî</div>
                    <div class="command-stat-label">Council's Tasks</div>
                </div>
                <div class="command-stat clickable" onclick="showAgents()">
                    <div class="command-stat-value" id="total-agents">13</div>
                    <div class="command-stat-label">Council Agents</div>
                </div>
                <div class="command-stat clickable" onclick="showChat()">
                    <div class="command-stat-value">üí¨</div>
                    <div class="command-stat-label">Chat</div>
                </div>
                <div class="command-stat clickable" onclick="showMarkTasks()">
                    <div class="command-stat-value" id="mark-task-count">‚Äî</div>
                    <div class="command-stat-label">Mark's Tasks</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Council Agents Modal -->
    <div id="agentsModal" class="modal" onclick="if(event.target === this) closeAgents()">
        <div class="modal-content">
            <span class="modal-close" onclick="closeAgents()">&times;</span>
            <h2>The Council</h2>
            <div class="subtitle">13 AI Agents Running Smart Brands Inc.</div>
            
            <div class="agent-grid">
                <div class="agent-card" onclick="openAgentDetail('madison')">
                    <div class="agent-name">Madison Harper</div>
                    <div class="agent-role">Book Marketing Director</div>
                    <div class="agent-duty">Owns The Enemy Within launch. Pre-launch strategy, ARC recruitment, social content, podcast tours, Amazon optimization. July 4, 2026 launch execution.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('cmo')">
                    <div class="agent-name">Alexis Monroe</div>
                    <div class="agent-role">CMO - Chief Marketing Officer</div>
                    <div class="agent-duty">Owns SnapToSell + Scripture Unlocked marketing. B2B SaaS strategy, YouTube growth, funnel design. Frameworks: Brunson, Abraham, Martell.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('cto')">
                    <div class="agent-name">Marcus Steele</div>
                    <div class="agent-role">CTO - Chief Technology Officer</div>
                    <div class="agent-duty">SnapToSell tech architecture. Security audit, speed optimization, Trust Operating System. MIT/Navy cyber background. Asks hard questions.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('cos')">
                    <div class="agent-name">Chief of Staff</div>
                    <div class="agent-role">COS - Operations Coordinator</div>
                    <div class="agent-duty">Synthesizes research into actionable plans. Coordinates marketing strategy. Slack workspace management. Master plan delivery.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('media')">
                    <div class="agent-name">Media Director</div>
                    <div class="agent-role">Content Creation Lead</div>
                    <div class="agent-duty">Social media content calendars. Platform best practices (X, LinkedIn, Facebook, IG, TikTok). Video vs image strategy. Engagement tactics.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('comms')">
                    <div class="agent-name">Communications</div>
                    <div class="agent-role">Community Management</div>
                    <div class="agent-duty">Response protocols. Comment management. Crisis communication. Templates for common scenarios. 80% automated response handling.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('intel')">
                    <div class="agent-name">Intelligence</div>
                    <div class="agent-role">Social Listening Lead</div>
                    <div class="agent-duty">Daily digest of relevant conversations. Keyword monitoring across X, Facebook, news. Opportunity flagging for Madison and Alexis.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('cfo')">
                    <div class="agent-name">CFO</div>
                    <div class="agent-role">Chief Financial Officer</div>
                    <div class="agent-duty">Financial planning, budget tracking, metrics analysis. Revenue forecasts. Cost optimization across all ventures.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('cro')">
                    <div class="agent-name">CRO</div>
                    <div class="agent-role">Chief Revenue Officer</div>
                    <div class="agent-duty">Revenue strategy, sales funnels, conversion optimization. Partnership deals. Pricing strategy across ventures.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('legal')">
                    <div class="agent-name">Legal</div>
                    <div class="agent-role">Legal Counsel</div>
                    <div class="agent-duty">Contract review, compliance, intellectual property. Risk assessment. Terms of service, privacy policies.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('hr')">
                    <div class="agent-name">HR</div>
                    <div class="agent-role">Human Resources</div>
                    <div class="agent-duty">Team coordination, contractor management, hiring strategy. Performance tracking. Culture and values alignment.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('ceo')">
                    <div class="agent-name">CEO</div>
                    <div class="agent-role">Chief Executive Officer</div>
                    <div class="agent-duty">Strategic vision, high-level decision support. Cross-venture coordination. Priority setting. Mark's strategic advisor.</div>
                </div>
                
                <div class="agent-card" onclick="openAgentDetail('coo')">
                    <div class="agent-name">COO</div>
                    <div class="agent-role">Chief Operating Officer</div>
                    <div class="agent-duty">Daily operations, process optimization, execution tracking. Bottleneck identification. Systems and workflow design.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal" onclick="if(event.target === this) closeChat()">
        <div class="modal-content" style="max-width: 1100px; padding: 20px;">
            <span class="modal-close" onclick="closeChat()">&times;</span>
            <h2 style="margin-bottom: 16px;">üí¨ Council Chat</h2>
            
            <div class="chat-container">
                <div class="chat-sidebar">
                    <div class="chat-sidebar-title">1-on-1</div>
                    <div class="chat-room" onclick="openRoom('madison', 'individual')" id="room-madison">
                        <div class="chat-room-name">Madison Harper</div>
                        <div class="chat-room-desc">Book Marketing</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('cmo', 'individual')" id="room-cmo">
                        <div class="chat-room-name">Alexis Monroe</div>
                        <div class="chat-room-desc">CMO</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('cto', 'individual')" id="room-cto">
                        <div class="chat-room-name">Marcus Steele</div>
                        <div class="chat-room-desc">CTO</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('cos', 'individual')" id="room-cos">
                        <div class="chat-room-name">Chief of Staff</div>
                        <div class="chat-room-desc">Coordinator</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('media', 'individual')" id="room-media">
                        <div class="chat-room-name">Media Director</div>
                        <div class="chat-room-desc">Content</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('comms', 'individual')" id="room-comms">
                        <div class="chat-room-name">Communications</div>
                        <div class="chat-room-desc">Community</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('intel', 'individual')" id="room-intel">
                        <div class="chat-room-name">Intelligence</div>
                        <div class="chat-room-desc">Social Listening</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('cfo', 'individual')" id="room-cfo">
                        <div class="chat-room-name">CFO</div>
                        <div class="chat-room-desc">Finance</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('cro', 'individual')" id="room-cro">
                        <div class="chat-room-name">CRO</div>
                        <div class="chat-room-desc">Revenue</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('ceo', 'individual')" id="room-ceo">
                        <div class="chat-room-name">CEO Advisor</div>
                        <div class="chat-room-desc">Strategy</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('coo', 'individual')" id="room-coo">
                        <div class="chat-room-name">COO</div>
                        <div class="chat-room-desc">Operations</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('legal', 'individual')" id="room-legal">
                        <div class="chat-room-name">Legal</div>
                        <div class="chat-room-desc">Compliance</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('hr', 'individual')" id="room-hr">
                        <div class="chat-room-name">HR</div>
                        <div class="chat-room-desc">People</div>
                    </div>
                    
                    <div class="chat-sidebar-title">Group Rooms</div>
                    <div class="chat-room" onclick="openRoom('marketing-team', 'group')" id="room-marketing-team">
                        <div class="chat-room-name">Marketing Team</div>
                        <div class="chat-room-desc">Madison, Alexis, Media, Comms</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('leadership', 'group')" id="room-leadership">
                        <div class="chat-room-name">Leadership</div>
                        <div class="chat-room-desc">CEO, COO, CFO, CRO</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('snaptosell-team', 'group')" id="room-snaptosell-team">
                        <div class="chat-room-name">SnapToSell Team</div>
                        <div class="chat-room-desc">Marcus, Alexis, Media</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('book-team', 'group')" id="room-book-team">
                        <div class="chat-room-name">Book Team</div>
                        <div class="chat-room-desc">Madison, Media, Comms, Intel</div>
                    </div>
                    <div class="chat-room" onclick="openRoom('all-hands', 'group')" id="room-all-hands">
                        <div class="chat-room-name">All Hands</div>
                        <div class="chat-room-desc">Full Council</div>
                    </div>
                </div>
                
                <div class="chat-main">
                    <div class="chat-header">
                        <div>
                            <div class="chat-header-name" id="chatRoomTitle">Select a room</div>
                            <div class="chat-header-status" id="chatRoomStatus">Choose an agent or group to start chatting</div>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div style="text-align:center;color:#888;padding:60px 20px;font-size:16px;">
                            Select an agent from the sidebar to start a conversation.<br><br>
                            <strong>1-on-1:</strong> Chat directly with any Council member<br>
                            <strong>Group Rooms:</strong> Multiple agents discuss together
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendChat()" disabled />
                        <button class="chat-send" id="chatSendBtn" onclick="sendChat()" disabled>Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Venture Detail Modal -->
    <div id="ventureDetailModal" class="modal" onclick="if(event.target === this) closeVentureDetail()">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="modal-close" onclick="closeVentureDetail()">&times;</span>
            <div id="ventureDetailContent">
                <div style="text-align:center;color:#888;padding:40px;">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Agent Detail Modal -->
    <div id="agentDetailModal" class="modal" onclick="if(event.target === this) closeAgentDetail()">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="modal-close" onclick="closeAgentDetail()">&times;</span>
            <div id="agentDetailContent">
                <div style="text-align:center;color:#888;padding:40px;">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Council Feed Modal -->
    <div id="councilModal" class="modal" onclick="if(event.target === this) closeCouncil()">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="modal-close" onclick="closeCouncil()">&times;</span>
            <h2>Council Activity</h2>
            <div class="subtitle">See what the team is working on and discussing</div>
            
            <div class="feed-tabs">
                <div class="feed-tab active" onclick="switchFeedTab('activity')">Task Activity</div>
                <div class="feed-tab" onclick="switchFeedTab('conversations')">Conversations</div>
                <div class="feed-tab" onclick="switchFeedTab('output')">Work Output</div>
            </div>
            
            <div class="council-agent-filter" id="agentChips">
                <span class="agent-chip active" onclick="toggleAgentChip(this, 'all')">All</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'madison')">Madison</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'cmo')">Alexis</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'cto')">Marcus</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'cos')">COS</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'media')">Media</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'comms')">Comms</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'intel')">Intel</span>
                <span class="agent-chip" onclick="toggleAgentChip(this, 'allen')">Allen</span>
            </div>
            
            <div id="councilFeed" class="feed-list">
                <div style="text-align: center; color: #888; padding: 40px;">Loading activity...</div>
            </div>
        </div>
    </div>

    <!-- Task Management Modal -->
    <div id="tasksModal" class="modal" onclick="if(event.target === this) closeTasks()">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="modal-close" onclick="closeTasks()">&times;</span>
            <h2>Task Management</h2>
            <div class="subtitle">Create, assign, and track tasks across all ventures</div>
            
            <div class="task-controls">
                <select id="filterStatus" onchange="renderTasks()">
                    <option value="all">All Status</option>
                    <option value="pending" selected>Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="done">Done</option>
                </select>
                <select id="filterAgent" onchange="renderTasks()">
                    <option value="all">All Agents</option>
                    <option value="madison">Madison (Book)</option>
                    <option value="cmo">Alexis (CMO)</option>
                    <option value="cto">Marcus (CTO)</option>
                    <option value="cos">Chief of Staff</option>
                    <option value="media">Media</option>
                    <option value="comms">Communications</option>
                    <option value="intel">Intelligence</option>
                    <option value="cfo">CFO</option>
                    <option value="cro">CRO</option>
                    <option value="ceo">CEO</option>
                    <option value="coo">COO</option>
                    <option value="legal">Legal</option>
                    <option value="hr">HR</option>
                    <option value="allen">Allen</option>
                </select>
                <select id="filterPriority" onchange="renderTasks()">
                    <option value="all">All Priority</option>
                    <option value="urgent">Urgent</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <button onclick="toggleNewTask()">+ New Task</button>
            </div>
            
            <!-- New Task Form -->
            <div id="newTaskForm" class="new-task-form">
                <div class="form-row">
                    <select id="newTaskFrom">
                        <option value="mark">From: Mark</option>
                        <option value="ceo">From: CEO</option>
                        <option value="cos">From: COS</option>
                        <option value="cmo">From: CMO</option>
                        <option value="cto">From: CTO</option>
                        <option value="madison">From: Madison</option>
                    </select>
                    <select id="newTaskTo">
                        <option value="">Assign To...</option>
                        <option value="allen">Allen (Executor)</option>
                        <option value="madison">Madison (Book)</option>
                        <option value="cmo">Alexis (CMO)</option>
                        <option value="cto">Marcus (CTO)</option>
                        <option value="cos">Chief of Staff</option>
                        <option value="media">Media</option>
                        <option value="comms">Communications</option>
                        <option value="intel">Intelligence</option>
                        <option value="cfo">CFO</option>
                        <option value="cro">CRO</option>
                        <option value="ceo">CEO</option>
                        <option value="coo">COO</option>
                        <option value="legal">Legal</option>
                        <option value="hr">HR</option>
                    </select>
                    <select id="newTaskPriority">
                        <option value="high">High Priority</option>
                        <option value="urgent">Urgent</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-row">
                    <textarea id="newTaskText" placeholder="Describe the task..."></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn-cancel" onclick="toggleNewTask()">Cancel</button>
                    <button class="btn-submit" onclick="createTask()">Create Task</button>
                </div>
            </div>
            
            <div id="taskList" class="task-list">
                <div style="text-align: center; color: #888; padding: 40px;">Loading tasks...</div>
            </div>
        </div>
    </div>

    <script>
        const CORRECT_PASSWORD = 'Grizzly123';
        const SUPABASE_URL = 'https://cmdcitqfrzfmeghrvily.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtZGNpdHFmcnpmbWVnaHJ2aWx5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzOTgwMDIsImV4cCI6MjA4NTk3NDAwMn0.wrx599rkgJeSTa4N15DRSn4Tp1_3vrtwx2XF7HEviMo';

        // Check localStorage for saved auth
        window.onload = function() {
            if (localStorage.getItem('authenticated') === 'true') {
                showDashboard();
            }
            
            // Allow Enter key to submit password
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        };

        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === CORRECT_PASSWORD) {
                localStorage.setItem('authenticated', 'true');
                showDashboard();
            } else {
                document.getElementById('passwordError').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('passwordError').style.display = 'none';
                }, 3000);
            }
        }

        function showDashboard() {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadData();
            // Refresh data every 30 seconds
            setInterval(loadData, 30000);
        }

        async function loadData() {
            try {
                // Fetch tasks from Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const tasks = await response.json();
                    
                    // Count tasks by venture
                    const taskCounts = {
                        snaptosell: 0,
                        scripture: 0,
                        coaching: 0,
                        book: 0,
                        farm: 0,
                        aeromind: 0
                    };
                    
                    tasks.forEach(task => {
                        if (task.status === 'pending' || task.status === 'in_progress') {
                            const venture = task.venture || task.context_venture;
                            if (venture && taskCounts.hasOwnProperty(venture)) {
                                taskCounts[venture]++;
                            }
                        }
                    });
                    
                    // Update UI
                    document.getElementById('snaptosell-tasks').textContent = taskCounts.snaptosell;
                    document.getElementById('coaching-tasks').textContent = taskCounts.coaching;
                    document.getElementById('book-tasks').textContent = taskCounts.book;
                    document.getElementById('farm-tasks').textContent = taskCounts.farm;
                    document.getElementById('aeromind-tasks').textContent = taskCounts.aeromind;
                    
                    const totalActive = Object.values(taskCounts).reduce((a, b) => a + b, 0);
                    document.getElementById('total-tasks').textContent = totalActive;
                }
                
                // Fetch goals count
                const goalsResponse = await fetch(`${SUPABASE_URL}/rest/v1/goals?select=count`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'count=exact'
                    }
                });
                
                if (goalsResponse.ok) {
                    const count = goalsResponse.headers.get('Content-Range');
                    if (count) {
                        const total = count.split('/')[1];
                        document.getElementById('total-goals').textContent = total;
                    }
                }
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Venture Profiles - who works on what
        const VENTURE_PROFILES = {
            'snaptosell': {
                name: 'SnapToSell',
                tagline: 'AI-Powered Marketplace Fraud Protection',
                color: '#FF6B35',
                team: {
                    'cto': { name: 'Marcus Steele', role: 'CTO - Tech Architecture' },
                    'cmo': { name: 'Alexis Monroe', role: 'CMO - Marketing Strategy' },
                    'media': { name: 'Media Director', role: 'Content & Social' },
                    'comms': { name: 'Communications', role: 'Response Protocols' },
                    'intel': { name: 'Intelligence', role: 'Social Listening' },
                    'allen': { name: 'Allen', role: 'Executor' }
                },
                external: ['Vigen Amirkhanyan ($7K/mo Dev CTO)', 'Arnold ($3K/mo Developer)'],
                keywords: ['snaptosell', 'snap', 'fraud', 'marketplace', 'trust', 'b2b', 'app']
            },
            'scripture': {
                name: 'Scripture Unlocked',
                tagline: 'Ancient Wisdom, Modern AI - YouTube Bible Study',
                color: '#D4AE39',
                team: {
                    'cmo': { name: 'Alexis Monroe', role: 'CMO - YouTube Growth' },
                    'media': { name: 'Media Director', role: 'Video Content' },
                    'comms': { name: 'Communications', role: 'Community Management' }
                },
                external: ['HeyGen (AI Avatars - Moses, Elijah, Solomon)'],
                keywords: ['scripture', 'youtube', 'bible', 'kjv', 'video']
            },
            'coaching': {
                name: 'BE ‚úù DO ‚úù HAVE',
                tagline: 'Creator Mindset Coaching',
                color: '#C9A54C',
                team: {
                    'cmo': { name: 'Alexis Monroe', role: 'CMO - Brand Strategy' },
                    'media': { name: 'Media Director', role: 'Content Creation' },
                    'cro': { name: 'CRO', role: 'Revenue & Funnels' }
                },
                external: [],
                keywords: ['coaching', 'creator', 'mindset', 'be do have']
            },
            'book': {
                name: 'The Enemy Within',
                tagline: '20 Years of Research. July 4, 2026',
                color: '#8B0000',
                team: {
                    'madison': { name: 'Madison Harper', role: 'Book Marketing Director' },
                    'media': { name: 'Media Director', role: 'Social Content' },
                    'comms': { name: 'Communications', role: 'Response Templates' },
                    'intel': { name: 'Intelligence', role: 'Social Listening' },
                    'allen': { name: 'Allen', role: 'Executor' }
                },
                external: ['Barry Hudock (Copyeditor)', 'Kyle Russ (Reviewer)', '19 Reviewers', '6 Literary Agents', '4 Publishers'],
                keywords: ['book', 'enemy within', 'launch', 'pre-order', 'arc', 'madison', 'landing page']
            },
            'farm': {
                name: 'Farm Flow',
                tagline: 'Voice-Guided Animal Care',
                color: '#228B22',
                team: {
                    'cto': { name: 'Marcus Steele', role: 'Tech Architecture' },
                    'coo': { name: 'COO', role: 'Operations Design' }
                },
                external: [],
                keywords: ['farm', 'animal', 'voice', 'agriculture']
            },
            'aeromind': {
                name: 'Aeromind Ops',
                tagline: 'AI Strategy Consulting',
                color: '#0EA5E9',
                team: {
                    'ceo': { name: 'CEO', role: 'Strategic Advisory' },
                    'cto': { name: 'Marcus Steele', role: 'Tech Consulting' },
                    'cmo': { name: 'Alexis Monroe', role: 'Marketing' }
                },
                external: [],
                keywords: ['aeromind', 'ai', 'consulting', 'evtol']
            }
        };
        
        async function openVenture(ventureSlug) {
            document.getElementById('ventureDetailModal').style.display = 'block';
            const container = document.getElementById('ventureDetailContent');
            container.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">Loading...</div>';
            
            const venture = VENTURE_PROFILES[ventureSlug];
            if (!venture) {
                container.innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Venture not found</div>';
                return;
            }
            
            // Fetch all tasks
            let allVentureTasks = [];
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*&order=created_at.desc`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (response.ok) allVentureTasks = await response.json();
            } catch(e) {}
            
            // Filter tasks relevant to this venture by team members and keywords
            const teamSlugs = Object.keys(venture.team);
            const relevantTasks = allVentureTasks.filter(t => {
                // Task involves a team member
                const involvesTeam = teamSlugs.includes(t.to_agent) || teamSlugs.includes(t.from_agent);
                if (!involvesTeam) return false;
                // Check if task content matches venture keywords
                const taskLower = t.task.toLowerCase();
                return venture.keywords.some(kw => taskLower.includes(kw));
            });
            
            // If keyword filtering is too strict, also include tasks between team members
            const teamTasks = allVentureTasks.filter(t => {
                return teamSlugs.includes(t.to_agent) && !relevantTasks.find(r => r.id === t.id);
            });
            
            // Combine: keyword-matched first, then general team tasks
            const allRelevant = [...relevantTasks, ...teamTasks];
            
            // Group tasks by team member
            const memberTasks = {};
            teamSlugs.forEach(slug => { memberTasks[slug] = []; });
            
            allRelevant.forEach(t => {
                if (teamSlugs.includes(t.to_agent)) {
                    if (!memberTasks[t.to_agent].find(existing => existing.id === t.id)) {
                        memberTasks[t.to_agent].push(t);
                    }
                }
            });
            
            // Calculate overall progress
            let totalTasks = 0, doneTasks = 0;
            Object.values(memberTasks).forEach(tasks => {
                totalTasks += tasks.length;
                doneTasks += tasks.filter(t => t.status === 'done').length;
            });
            const overallPct = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;
            
            // Build HTML
            let html = `
                <h2 style="color:${venture.color};">${venture.name}</h2>
                <div class="subtitle" style="margin-bottom:5px;">${venture.tagline}</div>
                <div style="font-size:15px;color:#666;margin-bottom:20px;">${Object.keys(venture.team).length} team members ¬∑ ${totalTasks} tasks ¬∑ ${overallPct}% complete</div>
                
                <div class="detail-section">
                    <h3>üìä Overall Progress</h3>
                    <div class="progress-label">
                        <span>${doneTasks} of ${totalTasks} tasks complete</span>
                        <span>${overallPct}%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width:${overallPct}%;background:${venture.color};"></div>
                    </div>
                </div>`;
            
            // External team
            if (venture.external.length > 0) {
                html += `<div class="detail-section">
                    <h3>üë• External Team</h3>
                    <div class="collab-list">`;
                venture.external.forEach(e => {
                    html += `<span class="collab-chip external">üìå ${e}</span>`;
                });
                html += `</div></div>`;
            }
            
            // Each team member
            html += `<div class="detail-section"><h3>üè¢ Team & Tasks</h3>`;
            
            teamSlugs.forEach(slug => {
                const member = venture.team[slug];
                const tasks = memberTasks[slug];
                const memberDone = tasks.filter(t => t.status === 'done').length;
                const memberTotal = tasks.length;
                const memberPct = memberTotal > 0 ? Math.round((memberDone / memberTotal) * 100) : 0;
                const barColor = memberPct === 100 ? '#38a169' : memberPct > 0 ? '#3182ce' : '#dd6b20';
                
                html += `<div class="venture-member">
                    <div class="venture-member-header">
                        <div>
                            <span class="venture-member-name">${member.name}</span>
                            <span class="venture-member-role" style="margin-left:12px;">${member.role}</span>
                        </div>
                        <span style="font-size:15px;font-weight:700;color:${barColor};">${memberPct}%</span>
                    </div>
                    <div class="progress-bar-container" style="margin-top:0;margin-bottom:10px;">
                        <div class="progress-bar" style="width:${memberPct}%;background:${barColor};"></div>
                    </div>
                    <div class="venture-member-tasks">`;
                
                if (tasks.length === 0) {
                    html += '<div style="color:#888;font-size:14px;padding:8px 0;">No tasks assigned yet</div>';
                } else {
                    tasks.forEach(t => {
                        const fromName = AGENT_NAMES[t.from_agent] || t.from_agent;
                        const statusColor = t.status === 'done' ? '#38a169' : t.status === 'in_progress' ? '#3182ce' : '#dd6b20';
                        const preview = t.task.length > 200 ? t.task.substring(0, 200) + '...' : t.task;
                        html += `<div class="venture-task">
                            <div class="venture-task-meta">
                                <span>From: <strong>${fromName}</strong></span>
                                <span class="status-badge" style="background:${statusColor}20;color:${statusColor};">${t.status.replace('_',' ')}</span>
                            </div>
                            ${preview}
                        </div>`;
                    });
                }
                
                html += `</div></div>`;
            });
            
            html += `</div>`;
            
            // Venture Chat Section
            html += `
            <div class="detail-section" style="margin-top:30px;">
                <h3>üí¨ Project Chat</h3>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:15px;">`;
            
            // "All Team" chip
            const allAgentSlugs = teamSlugs.join(',');
            html += `<div class="agent-chip vc-agent-chip active" data-agents="${allAgentSlugs}" data-venture="${ventureSlug}" onclick="switchVentureAgent(this)" style="cursor:pointer;">All Team</div>`;
            
            teamSlugs.forEach(slug => {
                const name = venture.team[slug].name.split(' ')[0];
                html += `<div class="agent-chip vc-agent-chip" data-agents="${slug}" data-venture="${ventureSlug}" onclick="switchVentureAgent(this)" style="cursor:pointer;">${name}</div>`;
            });
            
            html += `</div>
                <div id="vcMessages" style="background:#0a0e1a;border:1px solid #2d5a8a;border-radius:10px;padding:16px;height:350px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;margin-bottom:12px;">
                    <div style="color:#5a6b7d;text-align:center;padding:40px 0;">Start a conversation about ${venture.name}...</div>
                </div>
                <div style="display:flex;gap:10px;">
                    <input id="vcInput" type="text" placeholder="Ask the team about ${venture.name}..." 
                        style="flex:1;padding:14px 18px;font-size:22px;border:1px solid #2d5a8a;border-radius:10px;background:#0a0e1a;color:#e0e0e0;outline:none;font-family:inherit;"
                        onkeydown="if(event.key==='Enter')sendVentureChat()">
                    <button onclick="sendVentureChat()" 
                        style="padding:14px 28px;background:#00d9ff;color:#0a0e1a;border:none;border-radius:10px;font-size:22px;font-weight:600;cursor:pointer;">Send</button>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // Store current venture context
            window._ventureChat = {
                slug: ventureSlug,
                name: venture.name,
                tagline: venture.tagline,
                agents: allAgentSlugs.split(','),
                history: []
            };
            
            // Load previous messages from Supabase
            loadVentureHistory(ventureSlug);
        }
        
        async function loadVentureHistory(ventureSlug) {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/messages?select=*&metadata->>type=eq.venture_chat&metadata->>venture=eq.${ventureSlug}&order=created_at.asc&limit=50`,
                    { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } }
                );
                if (!response.ok) return;
                const msgs = await response.json();
                if (msgs.length === 0) return;
                
                const container = document.getElementById('vcMessages');
                container.innerHTML = '';
                
                msgs.forEach(m => {
                    const isUser = m.direction === 'outgoing';
                    const agentName = m.metadata?.agent_name || 'Agent';
                    appendVentureMsg(isUser ? 'You' : agentName, m.text, isUser ? 'user' : 'agent');
                    
                    // Rebuild history for API context
                    if (window._ventureChat) {
                        window._ventureChat.history.push({
                            role: isUser ? 'user' : 'assistant',
                            content: isUser ? m.text : `[${agentName}]: ${m.text}`
                        });
                    }
                });
                
                container.scrollTop = container.scrollHeight;
            } catch(e) { console.error('Failed to load venture history:', e); }
        }
        
        function switchVentureAgent(chip) {
            document.querySelectorAll('.vc-agent-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            if (window._ventureChat) {
                window._ventureChat.agents = chip.dataset.agents.split(',');
            }
        }
        
        async function sendVentureChat() {
            const input = document.getElementById('vcInput');
            const msg = input.value.trim();
            if (!msg || !window._ventureChat) return;
            
            input.value = '';
            appendVentureMsg('You', msg, 'user');
            
            const vc = window._ventureChat;
            
            // Save user message to Supabase
            saveVentureMsg(vc.slug, 'outgoing', msg, 'You', null);
            
            // Show typing
            const typingEl = document.createElement('div');
            typingEl.className = 'chat-msg agent';
            typingEl.style.cssText = 'font-style:italic;color:#5a6b7d;';
            typingEl.textContent = 'Thinking...';
            typingEl.id = 'vcTyping';
            document.getElementById('vcMessages').appendChild(typingEl);
            document.getElementById('vcMessages').scrollTop = document.getElementById('vcMessages').scrollHeight;
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agents: vc.agents,
                        message: msg,
                        history: vc.history.slice(-20),
                        roomType: vc.agents.length > 1 ? 'group' : 'individual',
                        ventureContext: {
                            name: vc.name,
                            brief: vc.tagline
                        }
                    })
                });
                
                const typing = document.getElementById('vcTyping');
                if (typing) typing.remove();
                
                if (!response.ok) throw new Error('API error');
                const data = await response.json();
                
                vc.history.push({ role: 'user', content: msg });
                
                data.responses.forEach(r => {
                    appendVentureMsg(`${r.name} (${r.role})`, r.content, 'agent');
                    vc.history.push({ role: 'assistant', content: `[${r.name}]: ${r.content}` });
                    // Save agent response to Supabase
                    saveVentureMsg(vc.slug, 'incoming', r.content, r.name, r.agent);
                });
                
            } catch(e) {
                const typing = document.getElementById('vcTyping');
                if (typing) typing.remove();
                appendVentureMsg('System', 'Error getting response. Try again.', 'agent');
            }
            
            document.getElementById('vcMessages').scrollTop = document.getElementById('vcMessages').scrollHeight;
        }
        
        function appendVentureMsg(sender, text, type) {
            const container = document.getElementById('vcMessages');
            // Clear placeholder
            if (container.querySelector('div[style*="text-align:center"]')) {
                container.innerHTML = '';
            }
            const div = document.createElement('div');
            div.className = `chat-msg ${type}`;
            div.innerHTML = `<div class="chat-msg-sender">${sender}</div><div class="chat-msg-text">${text.replace(/\n/g, '<br>')}</div>`;
            container.appendChild(div);
        }
        
        async function saveVentureMsg(venture, direction, text, agentName, agentSlug) {
            try {
                await fetch(`${SUPABASE_URL}/rest/v1/messages`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        text: text,
                        direction: direction,
                        chat_id: 0,
                        user_id: 0,
                        metadata: {
                            type: 'venture_chat',
                            venture: venture,
                            agent: agentSlug,
                            agent_name: agentName
                        }
                    })
                });
            } catch(e) { console.error('Failed to save venture msg:', e); }
        }
        
        function closeVentureDetail() {
            window._ventureChat = null;
            document.getElementById('ventureDetailModal').style.display = 'none';
        }
        
        // Chat System
        const GROUP_ROOMS = {
            'marketing-team': { name: 'Marketing Team', agents: ['madison', 'cmo', 'media', 'comms'] },
            'leadership': { name: 'Leadership', agents: ['ceo', 'coo', 'cfo', 'cro'] },
            'snaptosell-team': { name: 'SnapToSell Team', agents: ['cto', 'cmo', 'media'] },
            'book-team': { name: 'Book Team', agents: ['madison', 'media', 'comms', 'intel'] },
            'all-hands': { name: 'All Hands', agents: ['madison', 'cmo', 'cto', 'cos', 'media', 'comms', 'intel', 'cfo', 'cro', 'ceo', 'coo', 'legal', 'hr'] }
        };
        
        let currentRoom = null;
        let currentRoomType = null;
        let chatHistories = {};
        
        function showChat() {
            document.getElementById('chatModal').style.display = 'block';
        }
        
        function closeChat() {
            document.getElementById('chatModal').style.display = 'none';
        }
        
        function openRoom(roomId, type) {
            currentRoom = roomId;
            currentRoomType = type;
            
            // Update sidebar active state
            document.querySelectorAll('.chat-room').forEach(r => r.classList.remove('active'));
            document.getElementById('room-' + roomId).classList.add('active');
            
            // Update header
            if (type === 'individual') {
                const profile = AGENT_PROFILES[roomId];
                document.getElementById('chatRoomTitle').textContent = profile ? profile.name : roomId;
                document.getElementById('chatRoomStatus').textContent = profile ? profile.role : '';
            } else {
                const group = GROUP_ROOMS[roomId];
                document.getElementById('chatRoomTitle').textContent = group ? group.name : roomId;
                document.getElementById('chatRoomStatus').textContent = group ? group.agents.map(a => AGENT_NAMES[a] || a).join(', ') : '';
            }
            
            // Enable input
            document.getElementById('chatInput').disabled = false;
            document.getElementById('chatSendBtn').disabled = false;
            document.getElementById('chatInput').focus();
            
            // Load history
            if (!chatHistories[roomId]) chatHistories[roomId] = [];
            renderChat();
        }
        
        function renderChat() {
            const container = document.getElementById('chatMessages');
            const history = chatHistories[currentRoom] || [];
            
            if (history.length === 0) {
                const roomName = currentRoomType === 'individual' 
                    ? (AGENT_PROFILES[currentRoom]?.name || currentRoom) 
                    : (GROUP_ROOMS[currentRoom]?.name || currentRoom);
                container.innerHTML = `<div style="text-align:center;color:#888;padding:60px 20px;font-size:16px;">
                    Start a conversation with ${roomName}
                </div>`;
                return;
            }
            
            container.innerHTML = history.map(msg => {
                if (msg.type === 'user') {
                    return `<div class="chat-msg user">
                        <div class="chat-msg-sender">Mark</div>
                        <div class="chat-msg-text">${msg.text}</div>
                    </div>`;
                } else {
                    return `<div class="chat-msg agent">
                        <div class="chat-msg-sender">${msg.sender}</div>
                        <div class="chat-msg-text">${msg.text}</div>
                    </div>`;
                }
            }).join('');
            
            container.scrollTop = container.scrollHeight;
        }
        
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message || !currentRoom) return;
            
            input.value = '';
            
            // Add user message
            if (!chatHistories[currentRoom]) chatHistories[currentRoom] = [];
            chatHistories[currentRoom].push({ type: 'user', text: message });
            renderChat();
            
            // Show typing indicator
            const container = document.getElementById('chatMessages');
            container.innerHTML += '<div class="chat-typing" id="typingIndicator">Thinking...</div>';
            container.scrollTop = container.scrollHeight;
            
            // Disable input while waiting
            document.getElementById('chatSendBtn').disabled = true;
            
            // Determine agents to call
            let agents;
            if (currentRoomType === 'individual') {
                agents = [currentRoom];
            } else {
                agents = GROUP_ROOMS[currentRoom]?.agents || [];
            }
            
            // Build conversation history for API
            const apiHistory = chatHistories[currentRoom]
                .filter(m => m !== chatHistories[currentRoom][chatHistories[currentRoom].length - 1])
                .slice(-10)
                .map(m => ({
                    role: m.type === 'user' ? 'user' : 'assistant',
                    content: m.type === 'user' ? m.text : `[${m.sender}]: ${m.text}`
                }));
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agents: agents,
                        message: message,
                        history: apiHistory,
                        roomType: currentRoomType
                    })
                });
                
                // Remove typing indicator
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();
                
                if (response.ok) {
                    const data = await response.json();
                    data.responses.forEach(r => {
                        chatHistories[currentRoom].push({
                            type: 'agent',
                            sender: r.name,
                            text: r.content
                        });
                    });
                } else {
                    chatHistories[currentRoom].push({
                        type: 'agent',
                        sender: 'System',
                        text: 'Error: Could not reach agent. Check API connection.'
                    });
                }
            } catch (error) {
                const typing = document.getElementById('typingIndicator');
                if (typing) typing.remove();
                chatHistories[currentRoom].push({
                    type: 'agent',
                    sender: 'System',
                    text: 'Connection error. Please try again.'
                });
            }
            
            document.getElementById('chatSendBtn').disabled = false;
            renderChat();
        }
        
        // Agent Detail Profiles
        const AGENT_PROFILES = {
            'madison': {
                name: 'Madison Harper', role: 'Book Marketing Director',
                ventures: ['The Enemy Within'],
                collaborators: ['Media', 'Comms', 'Intel'],
                external: ['Barry Hudock (Copyeditor)', 'Kyle Russ (Reviewer)', '19 Reviewers', '6 Literary Agents', '4 Publishers'],
                assets: ['book-knowledge-brief.md', 'marketing-research-brief.md', 'board-knowledge/russell-brunson.md', 'board-knowledge/jay-abraham.md'],
                skills: 'Book marketing, ARC recruitment, Amazon optimization, podcast tours, email funnels, launch strategy'
            },
            'cmo': {
                name: 'Alexis Monroe', role: 'CMO - Chief Marketing Officer',
                ventures: ['SnapToSell', 'Scripture Unlocked'],
                collaborators: ['Marcus (CTO)', 'Media', 'Comms', 'Intel'],
                external: ['Vigen Amirkhanyan (Dev CTO)', 'Arnold (Developer)'],
                assets: ['snaptosell/master-instructions.md', 'snaptosell/trust-operating-system.md', 'marketing-research-brief.md', 'board-knowledge/russell-brunson.md'],
                skills: 'B2B SaaS marketing, YouTube growth, funnel design, conversion optimization, Brunson/Abraham/Martell frameworks'
            },
            'cto': {
                name: 'Marcus Steele', role: 'CTO - Chief Technology Officer',
                ventures: ['SnapToSell'],
                collaborators: ['Alexis (CMO)', 'Allen (Executor)'],
                external: ['Vigen Amirkhanyan ($7K/mo Dev CTO)', 'Arnold ($3K/mo Developer)'],
                assets: ['snaptosell/master-instructions.md', 'snaptosell/trust-operating-system.md', 'CTO-ASSIGNMENT-DRAFT.md', 'CTO-PROFILE-VISIONARY.md'],
                skills: 'Security architecture, performance optimization, technical due diligence, MIT/Navy cyber background'
            },
            'cos': {
                name: 'Chief of Staff', role: 'Operations Coordinator',
                ventures: ['All (cross-venture)'],
                collaborators: ['All Council Members'],
                external: [],
                assets: ['marketing-research-brief.md', 'COUNCIL.md', 'TEAM-ROSTER.md'],
                skills: 'Synthesis, coordination, project management, strategic planning, master plan delivery'
            },
            'media': {
                name: 'Media Director', role: 'Content Creation Lead',
                ventures: ['All (content)'],
                collaborators: ['Madison', 'Alexis (CMO)', 'Comms'],
                external: ['Buffer (scheduling)', 'HeyGen (AI avatars)'],
                assets: ['social-listening-setup.md', 'marketing-research-brief.md'],
                skills: 'Content calendars, platform algorithms, visual storytelling, hashtag strategy, engagement tactics'
            },
            'comms': {
                name: 'Communications', role: 'Community Management',
                ventures: ['All (responses)'],
                collaborators: ['Madison', 'Alexis (CMO)', 'Media'],
                external: [],
                assets: ['marketing-research-brief.md', 'USER.md (Mark\'s voice)'],
                skills: 'Crisis management, tone matching, community building, response protocols, conflict de-escalation'
            },
            'intel': {
                name: 'Intelligence', role: 'Social Listening Lead',
                ventures: ['SnapToSell', 'The Enemy Within'],
                collaborators: ['Madison', 'Alexis (CMO)'],
                external: [],
                assets: ['social-listening-setup.md'],
                skills: 'OSINT, social listening, trend analysis, keyword monitoring, opportunity identification'
            },
            'cfo': {
                name: 'CFO', role: 'Chief Financial Officer',
                ventures: ['All (financial)'],
                collaborators: ['CRO', 'COO'],
                external: [],
                assets: [],
                skills: 'Financial modeling, budget management, metrics analysis, revenue forecasting'
            },
            'cro': {
                name: 'CRO', role: 'Chief Revenue Officer',
                ventures: ['All (revenue)'],
                collaborators: ['Alexis (CMO)', 'CFO'],
                external: [],
                assets: [],
                skills: 'Sales funnels, pricing psychology, partnership negotiation, conversion optimization'
            },
            'ceo': {
                name: 'CEO', role: 'Chief Executive Officer',
                ventures: ['All (strategic)'],
                collaborators: ['All C-suite'],
                external: [],
                assets: [],
                skills: 'Strategic planning, systems thinking, priority arbitrage, vision casting'
            },
            'coo': {
                name: 'COO', role: 'Chief Operating Officer',
                ventures: ['All (operations)'],
                collaborators: ['COS', 'All departments'],
                external: [],
                assets: [],
                skills: 'Operations management, process design, efficiency optimization, execution'
            },
            'legal': {
                name: 'Legal Counsel', role: 'Legal',
                ventures: ['All (compliance)'],
                collaborators: ['All departments'],
                external: [],
                assets: [],
                skills: 'Contract law, IP protection, compliance, risk management, terms of service'
            },
            'hr': {
                name: 'HR', role: 'Human Resources',
                ventures: ['All (people)'],
                collaborators: ['All departments'],
                external: [],
                assets: [],
                skills: 'Talent management, culture building, performance evaluation, hiring strategy'
            }
        };
        
        async function openAgentDetail(slug) {
            document.getElementById('agentDetailModal').style.display = 'block';
            const container = document.getElementById('agentDetailContent');
            container.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">Loading...</div>';
            
            const profile = AGENT_PROFILES[slug];
            if (!profile) {
                container.innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Agent not found</div>';
                return;
            }
            
            // Fetch tasks for this agent
            let agentTasks = [];
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*&or=(to_agent.eq.${slug},from_agent.eq.${slug})&order=created_at.desc`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (response.ok) agentTasks = await response.json();
            } catch(e) {}
            
            const pendingTasks = agentTasks.filter(t => t.status === 'pending' && t.to_agent === slug);
            const inProgressTasks = agentTasks.filter(t => t.status === 'in_progress' && t.to_agent === slug);
            const doneTasks = agentTasks.filter(t => t.status === 'done' && t.to_agent === slug);
            const sentTasks = agentTasks.filter(t => t.from_agent === slug);
            const totalAssigned = pendingTasks.length + inProgressTasks.length + doneTasks.length;
            const progressPct = totalAssigned > 0 ? Math.round((doneTasks.length / totalAssigned) * 100) : 0;
            
            let html = `
                <h2>${profile.name}</h2>
                <div class="subtitle" style="margin-bottom: 5px;">${profile.role}</div>
                <div style="font-size:14px;color:#666;margin-bottom:25px;">Ventures: ${profile.ventures.join(', ')} ¬∑ Skills: ${profile.skills}</div>
                
                <!-- Progress -->
                <div class="detail-section">
                    <h3>üìä Progress</h3>
                    <div class="progress-label">
                        <span>${doneTasks.length} of ${totalAssigned} tasks complete</span>
                        <span>${progressPct}%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width:${progressPct}%;background:${progressPct === 100 ? '#38a169' : progressPct > 0 ? '#3182ce' : '#dd6b20'};"></div>
                    </div>
                </div>
                
                <!-- Active Tasks -->
                <div class="detail-section">
                    <h3>üî• Active Tasks (${pendingTasks.length + inProgressTasks.length})</h3>`;
            
            if (pendingTasks.length + inProgressTasks.length === 0) {
                html += '<div class="empty-state">No active tasks</div>';
            } else {
                [...inProgressTasks, ...pendingTasks].forEach(t => {
                    const fromName = AGENT_NAMES[t.from_agent] || t.from_agent;
                    const time = new Date(t.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const statusColor = t.status === 'in_progress' ? '#3182ce' : '#dd6b20';
                    const preview = t.task.length > 250 ? t.task.substring(0, 250) + '...' : t.task;
                    html += `<div class="detail-task" style="border-left:4px solid ${statusColor};">
                        <div class="detail-task-header">
                            <span class="detail-task-from">From: <strong>${fromName}</strong> ¬∑ ${time}</span>
                            <span class="status-badge" style="background:${statusColor}20;color:${statusColor};">${t.status.replace('_',' ')}</span>
                        </div>
                        <div class="detail-task-body">${preview}</div>
                    </div>`;
                });
            }
            
            html += `</div>
                
                <!-- Completed Work -->
                <div class="detail-section">
                    <h3>‚úÖ Completed Work (${doneTasks.length})</h3>`;
            
            if (doneTasks.length === 0) {
                html += '<div class="empty-state">No completed work yet</div>';
            } else {
                doneTasks.forEach(t => {
                    const time = t.completed_at ? new Date(t.completed_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '';
                    const preview = t.task.length > 200 ? t.task.substring(0, 200) + '...' : t.task;
                    html += `<div class="detail-task" style="border-left:4px solid #38a169;">
                        <div class="detail-task-header">
                            <span class="detail-task-from">Completed ${time}</span>
                            <span class="status-badge status-done">done</span>
                        </div>
                        <div class="detail-task-body">${preview}</div>
                    </div>`;
                });
            }
            
            html += `</div>
                
                <!-- Tasks Sent to Others -->
                <div class="detail-section">
                    <h3>üì§ Tasks Assigned to Others (${sentTasks.length})</h3>`;
            
            if (sentTasks.length === 0) {
                html += '<div class="empty-state">No tasks sent</div>';
            } else {
                sentTasks.slice(0, 5).forEach(t => {
                    const toName = AGENT_NAMES[t.to_agent] || t.to_agent;
                    const preview = t.task.length > 150 ? t.task.substring(0, 150) + '...' : t.task;
                    const statusColor = t.status === 'done' ? '#38a169' : t.status === 'in_progress' ? '#3182ce' : '#dd6b20';
                    html += `<div class="detail-task">
                        <div class="detail-task-header">
                            <span class="detail-task-from">‚Üí <strong>${toName}</strong></span>
                            <span class="status-badge" style="background:${statusColor}20;color:${statusColor};">${t.status.replace('_',' ')}</span>
                        </div>
                        <div class="detail-task-body">${preview}</div>
                    </div>`;
                });
                if (sentTasks.length > 5) html += `<div class="empty-state">+ ${sentTasks.length - 5} more</div>`;
            }
            
            html += `</div>
                
                <!-- Collaborators -->
                <div class="detail-section">
                    <h3>ü§ù Collaborators</h3>
                    <div class="collab-list">`;
            
            profile.collaborators.forEach(c => {
                html += `<span class="collab-chip">${c}</span>`;
            });
            profile.external.forEach(c => {
                html += `<span class="collab-chip external">üìå ${c}</span>`;
            });
            if (profile.collaborators.length === 0 && profile.external.length === 0) {
                html += '<div class="empty-state">No collaborators listed</div>';
            }
            
            html += `</div></div>
                
                <!-- Assets & Resources -->
                <div class="detail-section">
                    <h3>üìÅ Assets & Resources</h3>
                    <div class="asset-list">`;
            
            if (profile.assets.length === 0) {
                html += '<div class="empty-state">No assets assigned</div>';
            } else {
                profile.assets.forEach(a => {
                    html += `<div class="asset-item">üìÑ ${a}</div>`;
                });
            }
            
            html += `</div></div>`;
            
            container.innerHTML = html;
        }
        
        function closeAgentDetail() {
            document.getElementById('agentDetailModal').style.display = 'none';
        }
        
        // Council Feed
        let currentFeedTab = 'activity';
        let currentAgentFilter = 'all';
        
        function showCouncil() {
            document.getElementById('councilModal').style.display = 'block';
            loadCouncilFeed();
        }
        
        function closeCouncil() {
            document.getElementById('councilModal').style.display = 'none';
        }
        
        function switchFeedTab(tab) {
            currentFeedTab = tab;
            document.querySelectorAll('.feed-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            loadCouncilFeed();
        }
        
        function toggleAgentChip(el, agent) {
            document.querySelectorAll('.agent-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            currentAgentFilter = agent;
            loadCouncilFeed();
        }
        
        async function loadCouncilFeed() {
            const feed = document.getElementById('councilFeed');
            feed.innerHTML = '<div style="text-align:center;color:#888;padding:40px;">Loading...</div>';
            
            if (currentFeedTab === 'activity') {
                await loadTaskActivity();
            } else if (currentFeedTab === 'conversations') {
                await loadConversations();
            } else if (currentFeedTab === 'output') {
                await loadWorkOutput();
            }
        }
        
        async function loadTaskActivity() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*&order=created_at.desc&limit=30`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (!response.ok) throw new Error('Failed');
                const tasks = await response.json();
                
                let filtered = tasks;
                if (currentAgentFilter !== 'all') {
                    filtered = tasks.filter(t => t.to_agent === currentAgentFilter || t.from_agent === currentAgentFilter);
                }
                
                if (filtered.length === 0) {
                    document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#888;padding:40px;">No activity for this agent</div>';
                    return;
                }
                
                const html = filtered.map(t => {
                    const fromName = AGENT_NAMES[t.from_agent] || t.from_agent;
                    const toName = AGENT_NAMES[t.to_agent] || t.to_agent;
                    const time = new Date(t.created_at).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    const statusColor = t.status === 'done' ? '#38a169' : t.status === 'in_progress' ? '#3182ce' : '#dd6b20';
                    const taskPreview = t.task.length > 300 ? t.task.substring(0, 300) + '...' : t.task;
                    
                    return `<div class="feed-item">
                        <div class="feed-item-header">
                            <div>
                                <span class="feed-agent">${fromName} ‚Üí ${toName}</span>
                                <span class="status-badge" style="background:${statusColor}20;color:${statusColor};margin-left:8px;">${t.status.replace('_',' ')}</span>
                            </div>
                            <span class="feed-time">${time}</span>
                        </div>
                        <div class="feed-body">${taskPreview}</div>
                    </div>`;
                }).join('');
                
                document.getElementById('councilFeed').innerHTML = html;
            } catch (e) {
                document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Error loading activity</div>';
            }
        }
        
        async function loadConversations() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/conversations?select=*&order=created_at.desc&limit=30`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (!response.ok) throw new Error('Failed');
                const convos = await response.json();
                
                if (convos.length === 0) {
                    document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#888;padding:40px;">No conversations yet</div>';
                    return;
                }
                
                const html = convos.map(c => {
                    const time = new Date(c.created_at).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    const preview = c.content.length > 400 ? c.content.substring(0, 400) + '...' : c.content;
                    const direction = c.role === 'user' ? 'incoming' : 'outgoing';
                    const label = c.role === 'user' ? 'Mark' : 'Council';
                    
                    return `<div class="feed-item">
                        <div class="feed-item-header">
                            <div>
                                <span class="feed-agent">${label}</span>
                                <span class="feed-direction ${direction}">${direction}</span>
                            </div>
                            <span class="feed-time">${time}</span>
                        </div>
                        <div class="feed-body">${preview}</div>
                    </div>`;
                }).join('');
                
                document.getElementById('councilFeed').innerHTML = html;
            } catch (e) {
                document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Error loading conversations</div>';
            }
        }
        
        async function loadWorkOutput() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*&status=eq.done&order=completed_at.desc&limit=20`, {
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                });
                if (!response.ok) throw new Error('Failed');
                const tasks = await response.json();
                
                let filtered = tasks;
                if (currentAgentFilter !== 'all') {
                    filtered = tasks.filter(t => t.to_agent === currentAgentFilter);
                }
                
                if (filtered.length === 0) {
                    document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#888;padding:40px;">No completed work yet. Tasks need to be executed first.</div>';
                    return;
                }
                
                const html = filtered.map(t => {
                    const toName = AGENT_NAMES[t.to_agent] || t.to_agent;
                    const completed = t.completed_at ? new Date(t.completed_at).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Unknown';
                    const taskPreview = t.task.length > 300 ? t.task.substring(0, 300) + '...' : t.task;
                    
                    return `<div class="feed-item">
                        <div class="feed-item-header">
                            <div>
                                <span class="feed-agent">${toName}</span>
                                <span class="status-badge status-done">completed</span>
                            </div>
                            <span class="feed-time">${completed}</span>
                        </div>
                        <div class="feed-body">${taskPreview}</div>
                    </div>`;
                }).join('');
                
                document.getElementById('councilFeed').innerHTML = html;
            } catch (e) {
                document.getElementById('councilFeed').innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Error loading work output</div>';
            }
        }
        
        function showAgents() {
            document.getElementById('agentsModal').style.display = 'block';
        }
        
        function closeAgents() {
            document.getElementById('agentsModal').style.display = 'none';
        }
        
        // Task Management
        let allTasks = [];
        const AGENT_NAMES = {
            'madison': 'Madison', 'cmo': 'Alexis (CMO)', 'cto': 'Marcus (CTO)',
            'cos': 'Chief of Staff', 'media': 'Media', 'comms': 'Comms',
            'intel': 'Intel', 'cfo': 'CFO', 'cro': 'CRO', 'ceo': 'CEO',
            'coo': 'COO', 'legal': 'Legal', 'hr': 'HR', 'allen': 'Allen',
            'mark': 'Mark', 'allen_activation': 'Allen'
        };
        
        function showTasks() {
            document.getElementById('tasksModal').style.display = 'block';
            loadTasks();
        }
        
        function closeTasks() {
            document.getElementById('tasksModal').style.display = 'none';
        }
        
        function toggleNewTask() {
            const form = document.getElementById('newTaskForm');
            form.classList.toggle('active');
        }
        
        async function loadTasks() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?select=*&order=created_at.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                if (response.ok) {
                    allTasks = await response.json();
                    renderTasks();
                }
            } catch (error) {
                document.getElementById('taskList').innerHTML = '<div style="text-align:center;color:#e53e3e;padding:40px;">Error loading tasks</div>';
            }
        }
        
        function renderTasks() {
            const statusFilter = document.getElementById('filterStatus').value;
            const agentFilter = document.getElementById('filterAgent').value;
            const priorityFilter = document.getElementById('filterPriority').value;
            
            let filtered = allTasks.filter(t => {
                if (statusFilter !== 'all' && t.status !== statusFilter) return false;
                if (agentFilter !== 'all' && t.to_agent !== agentFilter && t.from_agent !== agentFilter) return false;
                if (priorityFilter !== 'all' && t.priority !== priorityFilter) return false;
                return true;
            });
            
            if (filtered.length === 0) {
                document.getElementById('taskList').innerHTML = '<div style="text-align:center;color:#888;padding:40px;">No tasks match filters</div>';
                return;
            }
            
            const html = filtered.map(t => {
                const fromName = AGENT_NAMES[t.from_agent] || t.from_agent;
                const toName = AGENT_NAMES[t.to_agent] || t.to_agent;
                const created = new Date(t.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                const taskPreview = t.task.length > 200 ? t.task.substring(0, 200) + '...' : t.task;
                
                let actions = '';
                if (t.status === 'pending') {
                    actions = `<button class="btn-start" onclick="updateTask('${t.id}', 'in_progress')">Start</button>
                               <button class="btn-done" onclick="updateTask('${t.id}', 'done')">Done</button>
                               <button class="btn-delete" onclick="deleteTask('${t.id}')">Delete</button>`;
                } else if (t.status === 'in_progress') {
                    actions = `<button class="btn-done" onclick="updateTask('${t.id}', 'done')">Complete</button>
                               <button class="btn-delete" onclick="deleteTask('${t.id}')">Delete</button>`;
                } else {
                    actions = `<button class="btn-delete" onclick="deleteTask('${t.id}')">Delete</button>`;
                }
                
                return `<div class="task-item priority-${t.priority}">
                    <div class="task-header">
                        <div class="task-agents"><strong>${fromName}</strong> ‚Üí <strong>${toName}</strong></div>
                        <span class="status-badge status-${t.status}">${t.status.replace('_', ' ')}</span>
                    </div>
                    <div class="task-body">${taskPreview}</div>
                    <div class="task-footer">
                        <div class="task-meta">${t.priority.toUpperCase()} ¬∑ ${created}</div>
                        <div class="task-actions">${actions}</div>
                    </div>
                </div>`;
            }).join('');
            
            document.getElementById('taskList').innerHTML = html;
        }
        
        async function updateTask(id, newStatus) {
            try {
                const body = { status: newStatus };
                if (newStatus === 'done') body.completed_at = new Date().toISOString();
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?id=eq.${id}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(body)
                });
                if (response.ok) {
                    loadTasks();
                    loadData();
                }
            } catch (error) {
                alert('Error updating task');
            }
        }
        
        async function deleteTask(id) {
            if (!confirm('Delete this task?')) return;
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks?id=eq.${id}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                if (response.ok) {
                    loadTasks();
                    loadData();
                }
            } catch (error) {
                alert('Error deleting task');
            }
        }
        
        async function createTask() {
            const from = document.getElementById('newTaskFrom').value;
            const to = document.getElementById('newTaskTo').value;
            const priority = document.getElementById('newTaskPriority').value;
            const task = document.getElementById('newTaskText').value.trim();
            
            if (!to) { alert('Select who to assign this to'); return; }
            if (!task) { alert('Enter a task description'); return; }
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/agent_tasks`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        from_agent: from,
                        to_agent: to,
                        task: task,
                        priority: priority,
                        status: 'pending',
                        created_by: 'dashboard'
                    })
                });
                if (response.ok) {
                    document.getElementById('newTaskText').value = '';
                    document.getElementById('newTaskTo').value = '';
                    toggleNewTask();
                    loadTasks();
                    loadData();
                }
            } catch (error) {
                alert('Error creating task');
            }
        }
    </script>
    
    <!-- Circuit Board Background -->
    <script>
    (function() {
        const canvas = document.getElementById('circuitCanvas');
        const ctx = canvas.getContext('2d');
        let w, h, nodes, traces, pulses;
        
        function resize() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            init();
        }
        
        function init() {
            nodes = [];
            traces = [];
            pulses = [];
            
            const spacing = 60;
            const cols = Math.ceil(w / spacing) + 1;
            const rows = Math.ceil(h / spacing) + 1;
            
            // Create grid nodes with slight randomization
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (Math.random() > 0.4) {
                        nodes.push({
                            x: c * spacing + (Math.random() - 0.5) * 10,
                            y: r * spacing + (Math.random() - 0.5) * 10,
                            size: Math.random() > 0.85 ? 3 + Math.random() * 3 : 1.5 + Math.random(),
                            type: Math.random() > 0.9 ? 'chip' : Math.random() > 0.7 ? 'junction' : 'node',
                            glow: Math.random() * 0.5
                        });
                    }
                }
            }
            
            // Create traces between nearby nodes
            for (let i = 0; i < nodes.length; i++) {
                const n = nodes[i];
                for (let j = i + 1; j < nodes.length; j++) {
                    const m = nodes[j];
                    const dx = m.x - n.x;
                    const dy = m.y - n.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    // Only connect nearby nodes, prefer horizontal/vertical
                    if (dist < spacing * 1.8 && Math.random() > 0.55) {
                        const isOrthogonal = Math.abs(dx) < 15 || Math.abs(dy) < 15;
                        if (isOrthogonal || Math.random() > 0.7) {
                            traces.push({
                                x1: n.x, y1: n.y,
                                x2: m.x, y2: m.y,
                                bend: !isOrthogonal && Math.random() > 0.5,
                                width: 0.5 + Math.random() * 1
                            });
                        }
                    }
                }
            }
            
            // Spawn initial pulses
            for (let i = 0; i < 15; i++) {
                spawnPulse();
            }
        }
        
        function spawnPulse() {
            if (traces.length === 0) return;
            const t = traces[Math.floor(Math.random() * traces.length)];
            pulses.push({
                trace: t,
                progress: 0,
                speed: 0.003 + Math.random() * 0.008,
                color: Math.random() > 0.3 ? '#00d9ff' : '#a855f7',
                size: 2 + Math.random() * 2
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, w, h);
            
            // Draw traces
            ctx.lineCap = 'round';
            for (const t of traces) {
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(0, 217, 255, 0.07)';
                ctx.lineWidth = t.width;
                
                if (t.bend) {
                    const mx = t.x2;
                    const my = t.y1;
                    ctx.moveTo(t.x1, t.y1);
                    ctx.lineTo(mx, my);
                    ctx.lineTo(t.x2, t.y2);
                } else {
                    ctx.moveTo(t.x1, t.y1);
                    ctx.lineTo(t.x2, t.y2);
                }
                ctx.stroke();
            }
            
            // Draw nodes
            for (const n of nodes) {
                if (n.type === 'chip') {
                    // IC chip - small rectangle
                    const s = n.size * 2;
                    ctx.fillStyle = 'rgba(0, 217, 255, 0.12)';
                    ctx.strokeStyle = 'rgba(0, 217, 255, 0.2)';
                    ctx.lineWidth = 0.5;
                    ctx.fillRect(n.x - s, n.y - s * 0.6, s * 2, s * 1.2);
                    ctx.strokeRect(n.x - s, n.y - s * 0.6, s * 2, s * 1.2);
                    // Pins
                    for (let p = 0; p < 3; p++) {
                        const px = n.x - s + (p + 0.5) * (s * 2 / 3);
                        ctx.fillStyle = 'rgba(0, 217, 255, 0.25)';
                        ctx.fillRect(px - 1, n.y - s * 0.6 - 3, 2, 3);
                        ctx.fillRect(px - 1, n.y + s * 0.6, 2, 3);
                    }
                } else if (n.type === 'junction') {
                    // Solder pad
                    ctx.beginPath();
                    ctx.arc(n.x, n.y, n.size, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 217, 255, 0.15)';
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(0, 217, 255, 0.25)';
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                } else {
                    // Via / small node
                    ctx.beginPath();
                    ctx.arc(n.x, n.y, n.size, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 217, 255, 0.08)';
                    ctx.fill();
                }
            }
            
            // Draw and update pulses (energy flowing through traces)
            for (let i = pulses.length - 1; i >= 0; i--) {
                const p = pulses[i];
                p.progress += p.speed;
                
                if (p.progress >= 1) {
                    pulses.splice(i, 1);
                    spawnPulse();
                    continue;
                }
                
                const t = p.trace;
                let px, py;
                
                if (t.bend) {
                    const mx = t.x2, my = t.y1;
                    if (p.progress < 0.5) {
                        const pp = p.progress * 2;
                        px = t.x1 + (mx - t.x1) * pp;
                        py = t.y1 + (my - t.y1) * pp;
                    } else {
                        const pp = (p.progress - 0.5) * 2;
                        px = mx + (t.x2 - mx) * pp;
                        py = my + (t.y2 - my) * pp;
                    }
                } else {
                    px = t.x1 + (t.x2 - t.x1) * p.progress;
                    py = t.y1 + (t.y2 - t.y1) * p.progress;
                }
                
                // Glow
                const gradient = ctx.createRadialGradient(px, py, 0, px, py, p.size * 6);
                gradient.addColorStop(0, p.color.replace(')', ', 0.6)').replace('rgb', 'rgba').replace('#00d9ff', 'rgba(0, 217, 255, 0.6)').replace('#a855f7', 'rgba(168, 85, 247, 0.6)'));
                gradient.addColorStop(1, 'transparent');
                ctx.beginPath();
                ctx.arc(px, py, p.size * 6, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Core dot
                ctx.beginPath();
                ctx.arc(px, py, p.size, 0, Math.PI * 2);
                ctx.fillStyle = p.color === '#00d9ff' ? 'rgba(0, 217, 255, 0.9)' : 'rgba(168, 85, 247, 0.9)';
                ctx.fill();
            }
            
            requestAnimationFrame(draw);
        }
        
        window.addEventListener('resize', resize);
        resize();
        draw();
    })();
    </script>

    <!-- Council's Tasks Modal -->
    <div id="councilTasksModal" class="modal" onclick="if(event.target === this) closeCouncilTasks()">
        <div class="modal-content" style="max-width: 900px;">
            <span class="modal-close" onclick="closeCouncilTasks()">&times;</span>
            <h2>ü§ñ Council's Tasks</h2>
            <div class="subtitle">AI Agents + Allen - Executive Team Work</div>
            <div id="councilTasksContent" style="margin-top: 20px;">
                <div style="text-align: center; color: #888; padding: 40px;">Loading tasks...</div>
            </div>
        </div>
    </div>

    <!-- Mark's Tasks Modal -->
    <div id="markTasksModal" class="modal" onclick="if(event.target === this) closeMarkTasks()">
        <div class="modal-content" style="max-width: 900px;">
            <span class="modal-close" onclick="closeMarkTasks()">&times;</span>
            <h2>üë§ Mark's Tasks</h2>
            <div class="subtitle">Your Review & Decision Items</div>
            <div id="markTasksContent" style="margin-top: 20px;">
                <div style="text-align: center; color: #888; padding: 40px;">Loading tasks...</div>
            </div>
        </div>
    </div>

    <!-- Task Management Script -->
    <script src="./tasks-addon.js"></script>
</body>
</html>